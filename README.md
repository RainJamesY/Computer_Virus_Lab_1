# 磁盘结构与文件系统——FAT32_reader
2023春网安计算机病毒课内实验1代码

组长：张逸凡 

组员：姚栋宇 张培妍

## 实验内容

# 实验内容

**\*内容一：手工定位和提取FAT32分区中的文件数据\***

在FAT32分区下创建一个不小于10K的Word文档（**\*文件名为本组组长名字的拼音，该名字必须在实验过程的截图中明确标出。\***），根据课上介绍的FAT32分区及文件系统知识，必要时自行上网查阅相关资料，借助WinHex或其它十六进制工具，以手工方式从磁盘中逐一找到该文件的各个存储扇区，复制其中的有效内容，并拼接组合成一个与原文档内容相同的完整文档。

**\*内容二：编程实现“内容一”的全过程\***

输入：**\*任一文件\***（A）的路径

输出：

（1）该文件的短文件名目录项信息

（2）该文件的簇链

（3）根据上述的文件簇链，从磁盘上提取数据并拼接而得的新文件（B）

（4）文件A与文件B内容的比较结果（要求二者完全一致）

## 功能简介

本代码运行在Windows环境下，用户可以通过修改代码中文件镜像和对比文件的名称，读取一个装在FAT32文件系统的磁盘映像，解析、查找磁盘的目录结构；从中导出文件；或将内部文件与对比文件进行数据对比

## 操作指南

使用时需将磁盘映像、代码、比对文件放在同一目录下，针对磁盘映像和比对文件的名称修改代码中的全局变量：**FILE_IMAGE**、**FILE_NAME**

修改后直接运行即可，导出生成的文件会存储在当前目录下，若想要更改生成文件名请修改main函数段中的**new_filename**变量。

## 代码输入

* 磁盘映像（xxx.img）
  * 我们的提供了自己的[样例磁盘镜像](https://drive.google.com/file/d/1oUbaTT4BNoo08I3psMLFLK-Y4ztkbZzI/view?usp=share_link)，下载后放在项目根目录下使用

* 比对文件（视存储至磁盘映像中的文件类型而定）

## 代码输出

* 磁盘映像DBR内容
```
> 每扇区字节数：bytes_per_sector

> 每簇扇区数：sectors_per_cluster

> 保留扇区数：reserved_sectors

> FAT个数：num_fats

> 每FAT扇区数：sectors_per_fat

> 根目录簇号：root_cluster

> 根目录偏移：root_cluster_offset
```
* 文件短目录项
```
> 文件扩展名：filename_extension

> 文件属性：attributes

> 文件起始簇号高16位：start_cluster_high

> 文件起始簇号低16位：start_cluster_low

> 文件大小：file_size
```
* 文件簇链：cluster_chain

* 新文件
```
> 文件生成于代码目录下，文件名为new_filename
```

* 文件比对结果
```
> 若文件比对结果相同，输出“文件内容完全相同”

> 若文件比对结果不同，输出“文件内容不相同”
```